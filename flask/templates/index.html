<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERIFLITE</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <div class="image-container">
        <a href="https://www.veriflite.com" target="_blank">
            <img src="{{ url_for('static', filename='veriflite.png') }}" alt="Veriflite Logo" class="responsive-image" style="width: 50%;">
        </a>
    </div>

    <div style="text-align:center; margin-bottom:0.5em;">
        <a href="{{ url_for('leaderboard') }}" style="margin:0 0.5em;">Leaderboard</a>
        <a href="{{ url_for('competition') }}" style="margin:0 0.5em;">Competition Report</a>
        <a href="{{ url_for('compare') }}" style="margin:0 0.5em;">Compare Athletes</a>
    </div>

    <h3>Search for Trampoline Competition Results</h3>
    <h4>
        Finds routines that match ALL fields.<br>
        Start with broad terms (eg Aus rather than Australia). <br>
        Don't be too specific!
    </h4>

    <form method="POST">
        <div style="text-align: right;">
            <a href="{{ url_for('clear_session') }}">Reset form</a>
        </div>
        <label for="discipline">Discipline:</label>
        <select name="discipline" id="discipline">
            <option value="tra" {% if discipline == 'tra' %}selected{% endif %}>Trampoline</option>
            <option value="dmt" {% if discipline == 'dmt' %}selected{% endif %}>Double Mini-Trampoline</option>
            <option value="tum" {% if discipline == 'tum' %}selected{% endif %}>Tumbling</option>
        </select>

        <label for="given_name">Given Name:</label> <input type="text" name="given_name" id="given_name" value="{{given_name}}"><br>
        <label for="surname">Surname:</label>
        <input type="text" name="surname" id="surname" value="{{surname}}" list="surname-suggestions" autocomplete="off">
        <datalist id="surname-suggestions"></datalist>
        <label for="representing">Representing:</label> <input type="text" name="representing" id="representing" value="{{representing}}"><br>
        <label for="stage">Stage:</label>
        <select name="stage" id="stage">
            <option value="" {% if not stage %}selected{% endif %}>All</option>
            <option value="Qualif" {% if stage == 'Qualif' %}selected{% endif %}>Qualification</option>
            <option value="Semifinal" {% if stage == 'Semifinal' %}selected{% endif %}>Semifinal</option>
            <option value="Final1" {% if stage == 'Final1' %}selected{% endif %}>Final</option>
            <option value="Team Final" {% if stage == 'Team Final' %}selected{% endif %}>Team Final</option>
        </select>
        <label for="dd">Difficulty:</label> <input type="text" name="dd" id="dd" value="{{dd}}"><br>
        <label for="mindd">Minimum Difficulty:</label> <input type="text" name="mindd" id="mindd" value="{{mindd}}"><br>
        <label for="mintof">Minimum Time of Flight:</label> <input type="text" name="mintof" id="mintof" value="{{mintof}}"><br>
        <label for="minhd">Minimum HD:</label> <input type="text" name="minhd" id="minhd" value="{{minhd}}"><br>
        <label for="minscore">Minimum Total Score:</label> <input type="text" name="minscore" id="minscore" value="{{minscore}}"><br>
        <label for="skills">Number of Skills:</label> <input type="text" name="skills" id="skills" value="{{skills}}"><br>
        <label for="since">Since:</label> <input type="date" name="since" id="since" value="{{since}}"><br>
        <label for="before">Before:</label> <input type="date" name="before" id="before" value="{{before}}"><br>
        <label for="year">Year:</label> <input type="text" name="year" id="year" value="{{year}}"><br>
        <label for="event">Competition:</label> <input type="text" name="event" id="event" value="{{event}}"><br>
        <label for="country">Host country:</label>
        <select id="country" name="country">
                <option value="" {% if country == "" %}selected{% endif %}></option>
                <option value="argentina" {% if country == "argentina" %}selected{% endif %}>Argentina</option>
                <option value="australia" {% if country == "australia" %}selected{% endif %}>Australia</option>
                <option value="belarus" {% if country == "belarus" %}selected{% endif %}>Belarus</option>
                <option value="brazil" {% if country == "brazil" %}selected{% endif %}>Brazil</option>
                <option value="bulgaria" {% if country == "bulgaria" %}selected{% endif %}>Bulgaria</option>
                <option value="colombia" {% if country == "colombia" %}selected{% endif %}>Colombia</option>
                <option value="czech_republic" {% if country == "czech_republic" %}selected{% endif %}>Czech Republic</option>
                <option value="denmark" {% if country == "denmark" %}selected{% endif %}>Denmark</option>
                <option value="estonia" {% if country == "estonia" %}selected{% endif %}>Estonia</option>
                <option value="finland" {% if country == "finland" %}selected{% endif %}>Finland</option>
                <option value="germany" {% if country == "germany" %}selected{% endif %}>Germany</option>
                <option value="japan" {% if country == "japan" %}selected{% endif %}>Japan</option>
                <option value="latvia" {% if country == "latvia" %}selected{% endif %}>Latvia</option>
                <option value="lithuania" {% if country == "lithuania" %}selected{% endif %}>Lithuania</option>
                <option value="mexico" {% if country == "mexico" %}selected{% endif %}>Mexico</option>
                <option value="netherlands" {% if country == "netherlands" %}selected{% endif %}>Netherlands</option>
                <option value="new_zealand" {% if country == "new_zealand" %}selected{% endif %}>New Zealand</option>
                <option value="philippines" {% if country == "philippines" %}selected{% endif %}>Philippines</option>
                <option value="poland" {% if country == "poland" %}selected{% endif %}>Poland</option>
                <option value="portugal" {% if country == "portugal" %}selected{% endif %}>Portugal</option>
                <option value="russian_federation" {% if country == "russian_federation" %}selected{% endif %}>Russian Federation</option>
                <option value="sweden" {% if country == "sweden" %}selected{% endif %}>Sweden</option>
                <option value="switzerland" {% if country == "switzerland" %}selected{% endif %}>Switzerland</option>
                <option value="united_kingdom" {% if country == "united_kingdom" %}selected{% endif %}>United Kingdom</option>
                <option value="united_states" {% if country == "united_states" %}selected{% endif %}>United States of America</option>
        </select>

        <label><input type="checkbox" name="female" {% if female %}checked{% endif %}> Female</label><br>
        <label><input type="checkbox" name="male" {% if male %}checked{% endif %}> Male</label><br>
        <label><input type="checkbox" name="sort_by_date" {% if sort_by_date %}checked{% endif %}> Sort by Date</label><br>
        <label><input type="checkbox" name="sort_by_execution" {% if sort_by_execution %}checked{% endif %}> Sort by Execution Score</label><br>
        <label><input type="checkbox" name="sort_by_dd" {% if sort_by_dd %}checked{% endif %}> Sort by Difficulty Score</label><br>
        <label><input type="checkbox" name="sort_by_tof" {% if sort_by_tof %}checked{% endif %}> Sort by ToF Score</label><br>

        <button type="submit">Submit</button>
    </form>

<div id="loading" style="display:none;">
  <div class="spinner"></div>
  <p>Searchingâ€¦</p>
</div>

<script>
  document.querySelector('form').addEventListener('submit', function() {
    document.getElementById('loading').style.display = 'flex';
    document.querySelector('button[type="submit"]').disabled = true;
  });

  document.getElementById('surname').addEventListener('input', function() {
    var q = this.value;
    if (q.length < 2) return;
    fetch('/autocomplete/athletes?q=' + encodeURIComponent(q))
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var dl = document.getElementById('surname-suggestions');
        dl.innerHTML = '';
        data.forEach(function(a) {
          var opt = document.createElement('option');
          opt.value = a.surname;
          opt.label = a.given_name + ' ' + a.surname;
          dl.appendChild(opt);
        });
      });
  });
</script>

</body>
</html>
